var net = require('net');
var EventEmitter = require('events').EventEmitter;


//module.exports = new EventEmitter();

var result = "";

var ez_b = new EventEmitter();

ez_b.client = null;


ez_b.connect = function connect(option) {
    if(ez_b.client == null){
        ez_b.client = net.connect({host:option.host, port: option.port}, function(){
            module.exports.emit('connect');
        });
    }else{
        module.exports.emit('connected');
    }

    ez_b.client.on('error', function(e){
        console.log('Failed to connect to EZ-Builder');
        module.exports.emit('connectError');
    });

    ez_b.client.on('end', function(){
        module.exports.emit('disconnect');
    });

    ez_b.client.on('data', function(data){
        console.log(data.toString());
    });

    

}

ez_b.Say = function(str){
    ez_b.client.write("say(" + str + ")\n");
}

ez_b.Servo = function(port, position){
    ez_b.client.write("Servo(" + port + ", "+ position +")\n");
}

ez_b.PWM = function(digitalPort, speed){
    ez_b.client.write("PWM(" + digitalPort + ", "+ speed +")\n");
}

ez_b.PWMRandom = function(digitalPort, lowspeed, highspeed){
    ez_b.client.write("PWM(" + digitalPort + ", "+ lowspeed +", " + highspeed + ")\n");
}

ez_b.Set = function(digitalPort, state){
    ez_b.client.write("Set(" + digitalPort + ", "+ state +")\n");
}

ez_b.ServoSpeed = function(digitalPort, speed){
    ez_b.client.write("ServoSpeed(" + digitalPort + ", "+ speed +")\n");
}

ez_b.ServoSpeedRandom = function(digitalPort, lowspeed, highspeed){
    ez_b.client.write("PWM(" + digitalPort + ", "+ lowspeed +", " + highspeed + ")\n");
}

ez_b.ServoUp = function(digitalPort, count){
    ez_b.client.write("ServoUp(" + digitalPort + ", "+ count +")\n");
}

ez_b.ServoDown = function(digitalPort, count){
    ez_b.client.write("ServoDown(" + digitalPort + ", "+ count +")\n");
}

ez_b.ServoSpeedRandom = function(digitalPort, lowPosition, highPosition){
    ez_b.client.write("ServoSpeedRandom(" + digitalPort + ", "+ lowPosition +", " + highPosition + ")\n");
}

ez_b.Release = function(servoPort){
    ez_b.client.write("Release(" + servoPort + ")\n");
}

ez_b.Move = function(servoPort, where){
    ez_b.client.write("Move(" + servoPort + ", "+ where +")\n");
}

ez_b.SetRandom = function(digitalPort){
    ez_b.client.write("SetRandom(" + digitalPort + ")\n");
}

ez_b.ToggleDigital = function(digitalPort){
    ez_b.client.write("ToggleDigital(" + digitalPort + ")\n");
}

ez_b.Forward = function(){
    ez_b.client.write("Forward()\n");   
}

ez_b.Reverse = function(){
    ez_b.client.write("Reverse()\n");   
}

ez_b.Left = function(){
    ez_b.client.write("Left()\n");   
}

ez_b.Right = function(){
    ez_b.client.write("Right()\n");   
}

ez_b.Up = function(milliSeconds){
    ez_b.client.write("Up(" + milliSeconds + ")\n");
}

ez_b.Down = function(milliSeconds){
    ez_b.client.write("Down(" + milliSeconds + ")\n");
}

ez_b.RollRight = function(milliSeconds){
    ez_b.client.write("RollRight(" + milliSeconds + ")\n");
}

ez_b.RollLeft = function(milliSeconds){
    ez_b.client.write("RollLeft(" + milliSeconds + ")\n");
}

ez_b.Stop = function(){
    ez_b.client.write("Stop()\n");
}

ez_b.Land = function(){
    ez_b.client.write("Land()\n");
}

ez_b.TakeOff = function(){
    ez_b.client.write("TakeOff()\n");
}

ez_b.DroneEmergency = function(){
    ez_b.client.write("DroneEmergency()\n");
}

ez_b.SpeakStop = function(){
    ez_b.client.write("SpeakStop()\n");
}

ez_b.SpeakRSS = function(url, index){
    if(typeof index == "undefined"){
        ez_b.client.write("SpeakRSS(" + url + ")\n");
    }else{
        ez_b.client.write("SpeakRSS(" + url + ", "+ index +")\n");
    }   
}

ez_b.SpeakTwitter = function(username, index){
    if(typeof index == "undefined"){
        ez_b.client.write("SpeakTwitter(" + username + ")\n");
    }else{
        ez_b.client.write("SpeakTwitter(" + username + ", "+ index +")\n");    
    }
}

ez_b.SendSerial = function(digitalPort, baudRate, data){
    ez_b.client.write("SendSerial(" + digitalPort + ", "+ baudRate +", " + data + ")\n");   
}

ez_b.MP3TriggerPlayTrack = function(digitalPort, baudRate, trackNumber, pauseTime){
    if(typeof pauseTime == "undefined"){
        ez_b.client.write("MP3TriggerPlayTrack(" + digitalPort + ", "+ baudRate +", " + trackNumber + ")\n");       
    }else{
        ez_b.client.write("MP3TriggerPlayTrack(" + digitalPort + ", "+ baudRate +", " + trackNumber + ", " + pauseTime +")\n");
    }
}

ez_b.MP3TriggerPlayRandomTrack = function(digitalPort, baudRate, lowestTrackNum, highestTrackNum){
    ez_b.client.write("MP3TriggerPlayRandomTrack(" + digitalPort + ", "+ baudRate +", " + lowestTrackNum + ", " + highestTrackNum +")\n");
}

ez_b.MP3TriggerNext = function(digitalPort, baudRate){
    ez_b.client.write("MP3TriggerNext(" + digitalPort + ", "+ baudRate +")\n");
}

ez_b.MP3TriggerStop = function(digitalPort, baudRate){
    ez_b.client.write("MP3TriggerStop(" + digitalPort + ", "+ baudRate +")\n");
}

ez_b.MP3TriggerPrev = function(digitalPort, baudRate){
    ez_b.client.write("MP3TriggerPrev(" + digitalPort + ", "+ baudRate +")\n");
}

ez_b.ControlCommand = function(windowName, ControlCommandParameter, values){
    if(typeof values == "undefined"){
        ez_b.client.write("ControlCommand(" + windowName + ", "+ ControlCommandParameter +")\n");       
    }else{
        ez_b.client.write("ControlCommand(" + windowName + ", "+ ControlCommandParameter +", " + values + ")\n");
    }
}

ez_b.Tweet = function(message){
    ez_b.client.write("Tweet(" + message + ")\n");
}

ez_b.Roomba = function(cmd){
    ez_b.client.write("Roomba(" + cmd + ")\n");
}

ez_b.Halt = function(){
    ez_b.client("Halt()\n");
}

ez_b.Exec = function(exe, parameters){
    if(typeof parameters == "undefined"){
        ez_b.client.write("Exec(" + exe + ")\n");       
    }else{
        ez_b.client.write("Exec(" + exe + ", "+ parameters +")\n");       
    }
}

ez_b.Browser = function(url){
    ez_b.client.write("Browser(" + url + ")\n");
}

ez_b.PlayAudio = function(url){
    ez_b.client.write("PlayAudio(" + url + ")\n");
}

ez_b.StopAudio = function(){
    ez_b.client("StopAudio()\n");   
}

ez_b.Pause = function(){
    ez_b.client("Pause()\n");   
}

ez_b.LoadProject = function(url){
    ez_b.client.write("LoadProject(" + url + ")\n");
}


ez_b.ConnectBoard = function(boardNumber){
    ez_b.client.write("ControlCommand(Connection, Connect" + boardNumber +")\n");
}

ez_b.DisconnectBoard = function(boardNumber){
    ez_b.client.write("ControlCommand(Connection, Disconnect" + boardNumber +")\n");   
}

ez_b.ConnectAllBoard = function(boardNumber){
    ez_b.client.write("ControlCommand(Connection, ConnectAll)\n");
}

ez_b.DisconnectAllBoard = function(boardNumber){
    ez_b.client.write("ControlCommand(Connection, DisconnectAll)\n");   
}

ez_b.RunScript = function(scriptName){
    ez_b.client.write("ControlCommand(Script Manager, ScriptStart, " + scriptName +")\n");   
}

ez_b.Exit = function(){
    if(ez_b.client != null){
        ez_b.client.end();
        ez_b.client = null;    
    }
}
module.exports = ez_b;